sudo: required
dist: trusty

language: node_js
node_js: "10"

cache:
  yarn: true
  directories: node_modules

matrix:
  include:
    - env: MODE=lint
      script: yarn lint

    - env: MODE=pa11y
      script:
        - yarn start
        - yarn pa11y-ci

    - env: MODE=deploy
      addons:
        chrome: stable

      script:
        - yarn build:ci
        - yarn test:ci
        - yarn e2e:ci
        - cat coverage/lcov.info | yarn coveralls

      deploy:
        skip_cleanup: true
        provider: firebase
        token:
          secure: $FIREBASE_TOKEN
        project: "slumber-numbers"
        on:
          branch: master

      notifications:
        email:
          on_failure: change
          on_success: change
